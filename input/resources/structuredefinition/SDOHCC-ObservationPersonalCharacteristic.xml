<?xml version="1.0" encoding="UTF-8"?>
<StructureDefinition
    xmlns="http://hl7.org/fhir">
    <id value="SDOHCC-ObservationPersonalCharacteristic"/>
    <meta>
        <versionId value="4"/>
        <lastUpdated value="2022-04-07T00:03:49.782+00:00"/>
        <source value="#YXDvUJZa6rjw4ok9"/>
    </meta>
    <url value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-ObservationPersonalCharacteristic"/>
    <name value="SDOHCCObservationPersonalCharacteristic"/>
    <title value="SDOHCC Observation Personal Characteristic"/>
    <status value="draft"/>
    <description value="Defines constraints that represent the minimum requirement for personal characteristic observations which are observations that are usually self-attested but may be attested to on behalf of the subject and are generally only verifiable by the source of attestation (e.g., race, ethnicity, sexual orientation, gender identity and personal pronouns), but may sometimes be verifiable by someone other than the source of attestation (e.g., recorded sex). This profile is intended for draft use only. The Cross-Group Projects work group granted an exception to US Core on XX/XX/2022 - Jira ticket XXXXX."/>
    <fhirVersion value="4.0.1"/>
    <kind value="resource"/>
    <abstract value="true"/>
    <type value="Observation"/>
    <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Observation"/>
    <derivation value="constraint"/>
    <differential>
        <element id="Observation">
            <path value="Observation"/>
            <short value="Personal characteristic observation"/>
            <definition value="Defines constraints that represent the minimum requirement for personal characteristic observations which are observations that are usually self-attested but may be attested to on behalf of the subject (e.g., for a minor or incapable subject) and are generally only verifiable by the source of attestation (e.g., race, ethnicity, sexual orientation, gender identity and personal pronouns), but may sometimes be verifiable by someone other than the source of attestation (e.g., recorded sex)."/>
            <constraint>
                <key value="SDOH-Obs-1"/>
                <severity value="error"/>
                <human value="Either subject or extension-Observation.subject must exist but not both"/>
                <expression value="subject.exists() xor extension('http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.subject').exists()"/>
                <xpath value="true()"/>
                <source value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-ObservationPersonalCharacteristic"/>
            </constraint>
            <constraint>
                <key value="SDOH-Obs-2"/>
                <severity value="error"/>
                <human value="Focus is only allowed if subject is present"/>
                <expression value="focus.exists() implies subject.exists()"/>
                <xpath value="true()"/>
                <source value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-ObservationPersonalCharacteristic"/>
            </constraint>
            <constraint>
                <key value="SDOH-Obs-3"/>
                <severity value="error"/>
                <human value="Must have either performer or derivedFrom"/>
                <expression value="performer.exists() or derivedFrom.exists()"/>
                <xpath value="true()"/>
                <source value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-ObservationPersonalCharacteristic"/>
            </constraint>
            <mustSupport value="false"/>
        </element>
        <element id="Observation.extension">
            <path value="Observation.extension"/>
            <slicing>
                <discriminator>
                    <type value="value"/>
                    <path value="url"/>
                </discriminator>
                <rules value="open"/>
            </slicing>
            <min value="0"/>
        </element>
        <element id="Observation.extension:OtherSubject">
            <path value="Observation.extension"/>
            <sliceName value="OtherSubject"/>
            <min value="0"/>
            <max value="1"/>
            <type>
                <code value="Extension"/>
                <profile value="http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.subject"/>
            </type>
            <condition value="SDOH-Obs-1"/>
            <mustSupport value="true"/>
        </element>
        <element id="Observation.extension:OtherSubject.value[x]">
            <path value="Observation.extension.value[x]"/>
            <min value="1"/>
            <type>
                <code value="Reference"/>
                <targetProfile value="http://hl7.org/fhir/us/core/StructureDefinition/us-core-practitioner"/>
            </type>
        </element>
        <element id="Observation.status">
            <path value="Observation.status"/>
            <short value="final | corrected | entered-in-error | unknown"/>
            <definition value="The status of the observation value."/>
            <requirements value="Further constrained to values that are relevant for personal characteristic observations."/>
            <mustSupport value="true"/>
            <binding>
                <strength value="required"/>
                <valueSet value="http://hl7.org/fhir/us/sdoh-clinicalcare/ValueSet/SDOHCC-ValueSetObservationStatus"/>
            </binding>
        </element>
        <element id="Observation.category">
            <path value="Observation.category"/>
            <slicing>
                <discriminator>
                    <type value="value"/>
                    <path value="$this"/>
                </discriminator>
                <rules value="open"/>
            </slicing>
            <min value="1"/>
        </element>
        <element id="Observation.category:PersonalCharacteristic">
            <path value="Observation.category"/>
            <sliceName value="PersonalCharacteristic"/>
            <requirements value="Used for filtering personal characteristic observations."/>
            <min value="1"/>
            <max value="1"/>
            <patternCodeableConcept>
                <coding>
                    <system value="http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes"/>
                    <code value="personal-characteristic"/>
                </coding>
            </patternCodeableConcept>
            <mustSupport value="true"/>
        </element>
        <element id="Observation.code">
            <path value="Observation.code"/>
            <mustSupport value="true"/>
        </element>
        <element id="Observation.subject">
            <path value="Observation.subject"/>
            <type>
                <code value="Reference"/>
                <targetProfile value="http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"/>
            </type>
            <condition value="SDOH-Obs-1"/>
            <condition value="SDOH-Obs-2"/>
            <mustSupport value="true"/>
        </element>
        <element id="Observation.focus">
            <path value="Observation.focus"/>
            <max value="1"/>
            <type>
                <code value="Reference"/>
                <targetProfile value="http://hl7.org/fhir/StructureDefinition/RelatedPerson"/>
            </type>
            <condition value="SDOH-Obs-2"/>
        </element>
        <element id="Observation.effective[x]">
            <path value="Observation.effective[x]"/>
            <type>
                <code value="dateTime"/>
            </type>
            <type>
                <code value="Period"/>
            </type>
        </element>
        <element id="Observation.performer">
            <path value="Observation.performer"/>
            <condition value="SDOH-Obs-3"/>
            <mustSupport value="true"/>
        </element>
        <element id="Observation.value[x]">
            <path value="Observation.value[x]"/>
            <type>
                <code value="CodeableConcept"/>
            </type>
            <mustSupport value="true"/>
        </element>
        <element id="Observation.interpretation">
            <path value="Observation.interpretation"/>
            <max value="0"/>
        </element>
        <element id="Observation.bodySite">
            <path value="Observation.bodySite"/>
            <max value="0"/>
        </element>
        <element id="Observation.specimen">
            <path value="Observation.specimen"/>
            <max value="0"/>
        </element>
        <element id="Observation.referenceRange">
            <path value="Observation.referenceRange"/>
            <max value="0"/>
        </element>
        <element id="Observation.derivedFrom">
            <path value="Observation.derivedFrom"/>
            <type>
                <code value="Reference"/>
                <targetProfile value="http://hl7.org/fhir/StructureDefinition/DocumentReference"/>
                <targetProfile value="http://hl7.org/fhir/StructureDefinition/QuestionnaireResponse"/>
                <targetProfile value="http://hl7.org/fhir/StructureDefinition/Observation"/>
            </type>
            <condition value="SDOH-Obs-3"/>
            <mustSupport value="true"/>
        </element>
    </differential>
</StructureDefinition>