<?xml version="1.0" encoding="UTF-8"?>
<StructureDefinition
    xmlns="http://hl7.org/fhir">
    <id value="SDOHCC-TaskForPatient"/>
    <meta>
        <versionId value="21"/>
        <lastUpdated value="2022-05-10T15:07:12.720+00:00"/>
        <source value="#9GLjyyfJ3jZjWzDj"/>
    </meta>
    <url value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-TaskForPatient"/>
    <name value="SDOHCCTaskForPatient"/>
    <title value="SDOHCC Task For Patient"/>
    <status value="draft"/>
    <description value="Profile for SDOH-related tasks to be carried out by the patient or someone acting on their behalf."/>
    <fhirVersion value="4.0.1"/>
    <mapping>
        <identity value="workflow"/>
        <uri value="http://hl7.org/fhir/workflow"/>
        <name value="Workflow Pattern"/>
    </mapping>
    <mapping>
        <identity value="rim"/>
        <uri value="http://hl7.org/v3"/>
        <name value="RIM Mapping"/>
    </mapping>
    <mapping>
        <identity value="w5"/>
        <uri value="http://hl7.org/fhir/fivews"/>
        <name value="FiveWs Pattern Mapping"/>
    </mapping>
    <mapping>
        <identity value="v2"/>
        <uri value="http://hl7.org/v2"/>
        <name value="HL7 v2 Mapping"/>
    </mapping>
    <kind value="resource"/>
    <abstract value="false"/>
    <type value="Task"/>
    <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Task"/>
    <derivation value="constraint"/>
    <differential>
        <element id="Task">
            <path value="Task"/>
            <short value="A request to fulfill an SDOH questionnaire or service request"/>
            <constraint>
                <key value="SDOH-Task-1"/>
                <severity value="error"/>
                <human value="If Task.code is “complete-questionnaire”, then exactly one Task.input of either &quot;questionnaire&quot;, &quot;questionnaire-pdf&quot;, or &quot;questionnaire-url&quot; is required and Task.input &quot;questionnaire-category&quot; is required."/>
                <expression value="code.coding.where(system='http://hl7.org/fhir/uv/sdc/CodeSystem/temp' and code='complete-questionnaire').exists() implies ((input.type.coding.where(system='http://hl7.org/fhir/uv/sdc/CodeSystem/temp' and code='questionnaire').exists() xor input.type.coding.where(system='http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes' and code='questionnaire-pdf').exists() xor input.type.coding.where(system='http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes' and code='questionnaire-url').exists()) and input.type.coding.where(system='http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes' and code='questionnaire-category').exists())"/>
                <xpath value="true()"/>
                <source value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-TaskForPatient"/>
            </constraint>
            <constraint>
                <key value="SDOH-Task-2"/>
                <severity value="error"/>
                <human value="If Task.code is “general-information”, then Task.description is required and either Task.output is absent or Task.output must be “general-information-response”."/>
                <expression value="code.coding.where(system='http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes' and code='general-information').exists() implies (description.exists() and (output.empty() or output.type.coding.all(system='http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes' and code='general-information-response').exists()))"/>
                <xpath value="true()"/>
                <source value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-TaskForPatient"/>
            </constraint>
            <constraint>
                <key value="SDOH-Task-3"/>
                <severity value="error"/>
                <human value="If Task.code is &quot;review-material&quot;, then Task.focus of DocumentReference is required."/>
                <expression value="code.coding.where(system='http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes' and code='review-material').exists() implies focus.resolve() is DocumentReference"/>
                <xpath value="true()"/>
                <source value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-TaskForPatient"/>
            </constraint>
            <constraint>
                <key value="SDOH-Task-4"/>
                <severity value="error"/>
                <human value="If Task.code is &quot;make-contact&quot;, then Task.input of at least one &quot;contact-entity&quot; is required."/>
                <expression value="code.coding.where(system='http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes' and code='make-contact').exists() implies input.type.coding.where(system='http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes' and code='contact-entity').exists()"/>
                <xpath value="true()"/>
                <source value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-TaskForPatient"/>
            </constraint>
            <constraint>
                <key value="SDOH-Task-5"/>
                <severity value="error"/>
                <human value="If Task.input is &quot;questionnaire&quot;, then Task.output, if present, must be &quot;questionnaire-response&quot;."/>
                <expression value="input.type.coding.where(system='http://hl7.org/fhir/uv/sdc/CodeSystem/temp' and code='questionnaire').exists() implies (output.type.coding.where(system='http://hl7.org/fhir/uv/sdc/CodeSystem/temp' and code='questionnaire-response').exists() or output.empty())"/>
                <xpath value="true()"/>
                <source value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-TaskForPatient"/>
            </constraint>
            <constraint>
                <key value="SDOH-Task-6"/>
                <severity value="error"/>
                <human value="If Task.input is &quot;questionnaire-pdf&quot;, then Task.output, if present, must be &quot;questionnaire-pdf-completed&quot;."/>
                <expression value="input.type.coding.where(system='http://hl7.org/fhir/uv/sdc/CodeSystem/temp' and code='questionnaire-pdf').exists() implies (output.type.coding.where(system='http://hl7.org/fhir/uv/sdc/CodeSystem/temp' and code='questionnaire-pdf-completed').exists() or output.empty())"/>
                <xpath value="true()"/>
                <source value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-TaskForPatient"/>
            </constraint>
            <constraint>
                <key value="SDOH-Task-7"/>
                <severity value="error"/>
                <human value="If Task.code is “make-contact”, then Task.description is required and either Task.output is absent or Task.output must be “chosen-contact”."/>
                <expression value="code.coding.where(system='http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes' and code='make-contact').exists() implies (description.exists() and (output.empty() or output.type.coding.all(system='http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes' and code='chosen-contact').exists()))"/>
                <xpath value="true()"/>
                <source value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-TaskForPatient"/>
            </constraint>
        </element>
        <element id="Task.partOf">
            <path value="Task.partOf"/>
            <slicing>
                <discriminator>
                    <type value="profile"/>
                    <path value="resolve()"/>
                </discriminator>
                <rules value="open"/>
            </slicing>
        </element>
        <element id="Task.partOf:SupportedPartOf">
            <path value="Task.partOf"/>
            <sliceName value="SupportedPartOf"/>
            <type>
                <code value="Reference"/>
                <targetProfile value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-TaskForReferralManagement"/>
                <targetProfile value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-TaskForPatient"/>
            </type>
            <mustSupport value="true"/>
        </element>
        <element id="Task.status">
            <path value="Task.status"/>
            <short value="ready | cancelled | completed | in progress | on hold"/>
            <comment value="Note that FHIR strings SHALL NOT exceed 1MB in size. For further details on Task.status see [Checking Task Status](checking_task_status.html)."/>
            <requirements value="These states enable coordination of task status with off-the-shelf workflow solutions that support automation of tasks. The values are constrained to ready | cancelled | completed | in progress | on hold. The task comes to the patient in the ready status and the patient can update status as appropriate."/>
            <mustSupport value="true"/>
            <binding>
                <strength value="required"/>
                <valueSet value="http://hl7.org/fhir/us/sdoh-clinicalcare/ValueSet/SDOHCC-ValueSetTaskStatus"/>
            </binding>
        </element>
        <element id="Task.statusReason">
            <path value="Task.statusReason"/>
            <definition value="If the task is cancelled by the patient, an explanation as to why should be provided."/>
            <comment value="This applies to the current status.  Look at the history of the task to see reasons for past statuses. If the Task.status is cancelled, then Task.statusReason.text should be included."/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.statusReason.text">
            <path value="Task.statusReason.text"/>
            <min value="1"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.intent">
            <path value="Task.intent"/>
            <short value="order"/>
            <definition value="Indicates the &quot;level&quot; of actionability associated with the Task."/>
            <comment value="Patient tasks will always be orders."/>
            <fixedCode value="order"/>
        </element>
        <element id="Task.priority">
            <path value="Task.priority"/>
            <short value="routine | urgent"/>
            <definition value="Indicates how quickly the Task should be addressed by the patient."/>
            <requirements value="Used to identify the level of priority assigned to this task. For tasks identified as urgent, the ability to deliver a related sevice may be dependent on task completion."/>
            <min value="1"/>
            <mustSupport value="true"/>
            <binding>
                <strength value="required"/>
                <valueSet value="http://hl7.org/fhir/us/sdoh-clinicalcare/ValueSet/SDOHCC-ValueSetTaskPriority"/>
            </binding>
        </element>
        <element id="Task.code">
            <path value="Task.code"/>
            <min value="1"/>
            <mustSupport value="true"/>
            <binding>
                <strength value="extensible"/>
                <valueSet value="http://hl7.org/fhir/us/sdoh-clinicalcare/ValueSet/SDOHCC-ValueSetTaskCode"/>
            </binding>
        </element>
        <element id="Task.code.text">
            <path value="Task.code.text"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.description">
            <path value="Task.description"/>
            <comment value="If Task.code is &quot;adhoc&quot;, Task.description should be displayed to the user with no other computable expectation other than allowing the patient to update the Task.status and optionally capture a free text response for Task.output."/>
            <condition value="SDOH-Task-2"/>
            <condition value="SDOH-Task-7"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.focus">
            <path value="Task.focus"/>
            <condition value="SDOH-Task-3"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.for">
            <path value="Task.for"/>
            <min value="1"/>
            <type>
                <code value="Reference"/>
                <targetProfile value="http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"/>
            </type>
            <mustSupport value="true"/>
        </element>
        <element id="Task.authoredOn">
            <path value="Task.authoredOn"/>
            <min value="1"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.requester">
            <path value="Task.requester"/>
            <min value="1"/>
            <type>
                <code value="Reference"/>
                <targetProfile value="http://hl7.org/fhir/us/core/StructureDefinition/us-core-practitionerrole"/>
                <targetProfile value="http://hl7.org/fhir/us/core/StructureDefinition/us-core-organization"/>
            </type>
            <mustSupport value="true"/>
        </element>
        <element id="Task.owner">
            <path value="Task.owner"/>
            <min value="1"/>
            <type>
                <code value="Reference"/>
                <targetProfile value="http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"/>
                <targetProfile value="http://hl7.org/fhir/StructureDefinition/RelatedPerson"/>
            </type>
            <mustSupport value="true"/>
        </element>
        <element id="Task.input">
            <path value="Task.input"/>
            <slicing>
                <discriminator>
                    <type value="pattern"/>
                    <path value="type"/>
                </discriminator>
                <rules value="open"/>
            </slicing>
        </element>
        <element id="Task.input:Questionnaire">
            <path value="Task.input"/>
            <sliceName value="Questionnaire"/>
            <max value="1"/>
            <condition value="SDOH-Task-1"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.input:Questionnaire.type">
            <path value="Task.input.type"/>
            <patternCodeableConcept>
                <coding>
                    <system value="http://hl7.org/fhir/uv/sdc/CodeSystem/temp"/>
                    <code value="questionnaire"/>
                </coding>
            </patternCodeableConcept>
            <binding>
                <strength value="example"/>
                <description value="Codes to identify types of input parameters.  These will typically be specific to a particular workflow.  The codes represent types of questionnaires that the patient might be asked to complete."/>
            </binding>
        </element>
        <element id="Task.input:Questionnaire.value[x]">
            <path value="Task.input.value[x]"/>
            <type>
                <code value="canonical"/>
                <targetProfile value="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-extr-smap"/>
            </type>
        </element>
        <element id="Task.input:QuestionnairePDF">
            <path value="Task.input"/>
            <sliceName value="QuestionnairePDF"/>
            <max value="1"/>
            <condition value="SDOH-Task-1"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.input:QuestionnairePDF.type">
            <path value="Task.input.type"/>
            <patternCodeableConcept>
                <coding>
                    <system value="http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes"/>
                    <code value="questionnaire-pdf"/>
                </coding>
            </patternCodeableConcept>
        </element>
        <element id="Task.input:QuestionnairePDF.value[x]">
            <path value="Task.input.value[x]"/>
            <type>
                <code value="Reference"/>
                <targetProfile value="http://hl7.org/fhir/us/core/StructureDefinition/us-core-documentreference"/>
            </type>
        </element>
        <element id="Task.input:QuestionnaireURL">
            <path value="Task.input"/>
            <sliceName value="QuestionnaireURL"/>
            <max value="1"/>
            <condition value="SDOH-Task-1"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.input:QuestionnaireURL.type">
            <path value="Task.input.type"/>
            <patternCodeableConcept>
                <coding>
                    <system value="http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes"/>
                    <code value="questionnaire-url"/>
                </coding>
            </patternCodeableConcept>
        </element>
        <element id="Task.input:QuestionnaireURL.value[x]">
            <path value="Task.input.value[x]"/>
            <type>
                <code value="url"/>
            </type>
        </element>
        <element id="Task.input:QuestionnaireCategory">
            <path value="Task.input"/>
            <sliceName value="QuestionnaireCategory"/>
            <max value="1"/>
            <condition value="SDOH-Task-1"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.input:QuestionnaireCategory.type">
            <path value="Task.input.type"/>
            <patternCodeableConcept>
                <coding>
                    <system value="http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes"/>
                    <code value="questionnaire-category"/>
                </coding>
            </patternCodeableConcept>
        </element>
        <element id="Task.input:QuestionnaireCategory.value[x]">
            <path value="Task.input.value[x]"/>
            <type>
                <code value="CodeableConcept"/>
            </type>
            <binding>
                <strength value="required"/>
                <description value="Types of Social Determinant of Health (SDOH) questionnaires that the patient might be asked to complete"/>
                <valueSet value="http://hl7.org/fhir/us/sdoh-clinicalcare/ValueSet/SDOHCC-ValueSetSDOHQuestionnaireCategory"/>
            </binding>
        </element>
        <element id="Task.input:Contact">
            <path value="Task.input"/>
            <sliceName value="Contact"/>
            <comment value="If Task.code is &quot;make-contact&quot; and multiple Task.inputs are provided, the intent is that the task owner selects only one to contact. If more than one contact needs to be made, there should be separate Tasks."/>
            <condition value="SDOH-Task-4"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.input:Contact.type">
            <path value="Task.input.type"/>
            <comment value="When Task.code is &quot;make-contact&quot;, &quot;contact-service&quot; is used for Task.input.type to indicate that the task owner should contact one of the healthcare services represented in Task.input.value."/>
            <patternCodeableConcept>
                <coding>
                    <system value="http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes"/>
                    <code value="contact-entity"/>
                </coding>
            </patternCodeableConcept>
        </element>
        <element id="Task.input:Contact.value[x]">
            <path value="Task.input.value[x]"/>
            <type>
                <code value="Reference"/>
                <targetProfile value="http://hl7.org/fhir/us/sdoh-clinicalcare/StructureDefinition/SDOHCC-HealthcareService"/>
                <targetProfile value="http://hl7.org/fhir/us/core/StructureDefinition/us-core-practitionerrole"/>
                <targetProfile value="http://hl7.org/fhir/us/core/StructureDefinition/us-core-practitioner"/>
                <targetProfile value="http://hl7.org/fhir/us/core/StructureDefinition/us-core-organization"/>
            </type>
        </element>
        <element id="Task.output">
            <path value="Task.output"/>
            <slicing>
                <discriminator>
                    <type value="pattern"/>
                    <path value="type"/>
                </discriminator>
                <rules value="open"/>
            </slicing>
            <condition value="SDOH-Task-2"/>
            <condition value="SDOH-Task-5"/>
            <condition value="SDOH-Task-6"/>
            <condition value="SDOH-Task-7"/>
        </element>
        <element id="Task.output:QuestionnaireResponse">
            <path value="Task.output"/>
            <sliceName value="QuestionnaireResponse"/>
            <max value="1"/>
            <condition value="SDOH-Task-5"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.output:QuestionnaireResponse.type">
            <path value="Task.output.type"/>
            <patternCodeableConcept>
                <coding>
                    <system value="http://hl7.org/fhir/uv/sdc/CodeSystem/temp"/>
                    <code value="questionnaire-response"/>
                </coding>
            </patternCodeableConcept>
        </element>
        <element id="Task.output:QuestionnaireResponse.value[x]">
            <path value="Task.output.value[x]"/>
            <type>
                <code value="Reference"/>
                <targetProfile value="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse"/>
            </type>
        </element>
        <element id="Task.output:QuestionnairePDFCompleted">
            <path value="Task.output"/>
            <sliceName value="QuestionnairePDFCompleted"/>
            <max value="1"/>
            <condition value="SDOH-Task-6"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.output:QuestionnairePDFCompleted.type">
            <path value="Task.output.type"/>
            <patternCodeableConcept>
                <coding>
                    <system value="http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes"/>
                    <code value="questionnaire-pdf-completed"/>
                </coding>
            </patternCodeableConcept>
        </element>
        <element id="Task.output:QuestionnairePDFCompleted.value[x]">
            <path value="Task.output.value[x]"/>
            <type>
                <code value="Reference"/>
                <targetProfile value="http://hl7.org/fhir/us/core/StructureDefinition/us-core-documentreference"/>
            </type>
        </element>
        <element id="Task.output:GeneralInformationResponse">
            <path value="Task.output"/>
            <sliceName value="GeneralInformationResponse"/>
            <condition value="SDOH-Task-2"/>
            <condition value="SDOH-Task-7"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.output:GeneralInformationResponse.type">
            <path value="Task.output.type"/>
            <patternCodeableConcept>
                <coding>
                    <system value="http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes"/>
                    <code value="general-information-response"/>
                </coding>
            </patternCodeableConcept>
        </element>
        <element id="Task.output:GeneralInformationResponse.value[x]">
            <path value="Task.output.value[x]"/>
            <type>
                <code value="markdown"/>
            </type>
        </element>
        <element id="Task.output:ChosenContact">
            <path value="Task.output"/>
            <sliceName value="ChosenContact"/>
            <comment value="If Task.code is &quot;make-contact&quot; and multiple Task.inputs are provided, the intent is that the task owner selects only one to contact and can indicate the &quot;chosen-contact&quot;."/>
            <max value="1"/>
            <condition value="SDOH-Task-7"/>
            <mustSupport value="true"/>
        </element>
        <element id="Task.output:ChosenContact.type">
            <path value="Task.output.type"/>
            <patternCodeableConcept>
                <coding>
                    <system value="http://hl7.org/fhir/us/sdoh-clinicalcare/CodeSystem/SDOHCC-CodeSystemTemporaryCodes"/>
                    <code value="chosen-contact"/>
                </coding>
            </patternCodeableConcept>
        </element>
        <element id="Task.output:ChosenContact.value[x]">
            <path value="Task.output.value[x]"/>
            <type>
                <code value="markdown"/>
            </type>
        </element>
    </differential>
</StructureDefinition>