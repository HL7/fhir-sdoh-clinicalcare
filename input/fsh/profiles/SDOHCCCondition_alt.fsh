RuleSet: CodeSlicing
* code ^slicing.discriminator.type = #pattern
* code ^slicing.discriminator.path = "$this"
* code ^slicing.rules = #open
* code ^slicing.description = "Slicing requires the given value but allows additional categories"
* category 1.. MS
* category contains
  required 1..1

Alias: $educationalAttainmentConditionVS = https://cts.nlm.nih.gov/fhir/res/ValueSet/2.16.840.1.113762.1.4.1247.103
Alias: $elderAbuseConditionVS = https://cts.nlm.nih.gov/fhir/res/ValueSet/2.16.840.1.113762.1.4.1247.63
Alias: $unemploymentConditionVS = https://cts.nlm.nih.gov/fhir/res/ValueSet/2.16.840.1.113762.1.4.1247.62

Alias: $financialInsecurityConditionVS = https://cts.nlm.nih.gov/fhir/res/ValueSet/2.16.840.1.113762.1.4.1247.108
Alias: $foodInsecurityConditionVS = https://cts.nlm.nih.gov/fhir/res/ValueSet/2.16.840.1.113762.1.4.1247.17
Alias: $healthInsuranceCoverageStatusConditionVS = https://cts.nlm.nih.gov/fhir/res/ValueSet/2.16.840.1.113762.1.4.1247.148


Profile: SDOHCCConditionAlt
Parent: USCoreCondition
Id: SDOHCC-ConditionAlt
Title: "SDOHCC Condition - Alternate"
Description: "Profile for Social Determinants of Health (SDOH) conditions."
* ^meta.versionId = "23"
* ^meta.lastUpdated = "2022-08-30T13:43:44.568+00:00"
* ^meta.source = "#w2NX9ggeoO7TtL08"
* ^version = "0.1.0"
* ^status = #draft
* ^date = "2020-12-14T04:01:34+00:00"
* ^jurisdiction = urn:iso:std:iso:3166#US
* obeys SDOH-Con-1
* . ^short = "Detailed information about SDOH conditions, problems or diagnoses"
  * ^definition = "For representation of SDOH conditions."
  * ^comment = "Many of the SDOHCC profiles reference one another. One flow supported by this IG is that QuestionnaireResponses result in Observations that can be used as evidence for Conditions that can lead to Goals, ServiceRequests and Procedures. However, alternatives paths (e.g., to arrive at SDOH Conditions) are also possible.\r\n\r\nOne specific use for this profile is to represent a Health Concern that is either; 1) directly asserted based on the patient’s answer to a specific question from an SDOH screening questionnaire or 2) computed/generated based on the patient’s answers to multiple questions. The questions and answers from the screening questionnaire are also represented using SDC Questionnaire, SDC QuestionnaireResponse and SDOHCC Screening Response Observation."
* extension ^slicing.discriminator.type = #value
  * ^slicing.discriminator.path = "url"
  * ^slicing.rules = #open
  * ^min = 0
* extension contains SDOHCCExtensionConditionAsserter named asserterDevice 0..1 MS
* extension[asserterDevice] ^requirements = "For a condition that is autogenerated based on a computation that uses the patient’s answers to multiple questions on a SDOH questionnaire, this extension should be used to specify the device used to compute the condition."
  * ^condition = "SDOH-Con-1"
  * value[x] only Reference(Device)
* verificationStatus ^comment = "verificationStatus is not required.  For example, when a patient complains of stress during a provider encounter, there is not likely going to be a verification status. The data type is CodeableConcept because verificationStatus has some clinical judgment involved, such that there might need to be more specificity than the required FHIR value set allows. For example, a SNOMED coding might allow for additional specificity.\r\n\r\nFor SDOH conditions that are autogenerated based on a questionnaire response, the Condition.asserter is a “Device” AND Condition.Category should be \"health-concern\". In that case, Condition.verificationStatus should be \"unconfirmed\" and should be changed to “confirmed” only after review and concurrence by the provider and patient."
* category ^slicing.discriminator.type = #value
  * ^slicing.discriminator.path = "$this"
  * ^slicing.rules = #open
  * ^requirements = "For a condition that is autogenerated based only on an individual's responses to an SDOH questionnaire, category should be \"health-concern\"."
* category contains SDOH 0..*
* category[SDOH] from SDOHCCValueSetSDOHCategory (required)
  * ^short = "e.g., food-insecurity | transportation-insecurity"
  * ^definition = "An SDOH category assigned to the condition."
  * ^requirements = "Codes from this value set can be used to assign one or more SDOH categories (e.g., food-insecurity, transportation-insecurity, etc.) to a condition. It is recommended that SDOH category codes be used to facilitate searching for SDOH conditions."
  * ^binding.description = "Codes for high-level SDOH categories."
* code ^comment = "As the Gravity Project continues to refine content for the SDOH categories (e.g., food, housing, transportation, etc.), this value set will be refined to codes that pertain to SDOH categories. For further guidance on external value sets vetted by the Gravity Project see: [SDOH terminology guidance](support_for_multiple_domains.html#external-value-set-guidance)"
  * ^requirements = "Code is required and must be selected from the bound value set."
  * ^binding.strength = #required
* code.coding ^slicing.discriminator.type = #value
  * ^slicing.discriminator.path = "$this"
  * ^slicing.rules = #open
* code.coding contains
  educational-attainment 0..1 and
  elder-abuse 0..1 and
  unemployment  0..1 and
  financial-insecurity 0..1 and
  food-insecurity 0..1 and
  health-insurance-coverage 0..1

* code.coding[educational-attainment] from $educationalAttainmentConditionVS
* code.coding[educational-attainment] ^short = "Educational Attainment"
* code.coding[elder-abuse] from $elderAbuseConditionVS
* code.coding[elder-abuse] ^short = "Elder Abuse"
* code.coding[unemployment] from $unemploymentConditionVS
* code.coding[unemployment] ^short = "Unemployment"
* code.coding[financial-insecurity] from $financialInsecurityConditionVS
* code.coding[financial-insecurity] ^short = "Financial Insecurity"
* code.coding[food-insecurity] from $foodInsecurityConditionVS
* code.coding[food-insecurity] ^short = "Food Insecurity"
* code.coding[health-insurance-coverage] from $healthInsuranceCoverageStatusConditionVS
* code.coding[health-insurance-coverage] ^short = "Health Insurance Coverage"


* bodySite ..0
* subject ^definition = "Indicates the patient who the condition record is associated with."
  * ^requirements = "US Core Condition Profile restricts subject to patient."
* onset[x] only dateTime or Period
* onset[x] MS
  * ^short = "Estimated dateTime or Period"
  * ^definition = "Estimated or actual dateTime or Period the condition began."
  * ^comment = "For SDOH conditions that have their onset over an extended (or fuzzy) period (e.g., the past month), Condition.onset may use a lower precision representation (e.g., month/year or year) as opposed to a higher precision representation (e.g., year/month/date/hour/min)."
* abatement[x] only dateTime or Period
* abatement[x] MS
  * ^definition = "The estimated or actual dateTime or Period that the condition resolved or went into remission. This is called \"abatement\" because of the many overloaded connotations associated with \"remission\" or \"resolution\"."
  * ^comment = "There is no explicit distinction between resolution and remission because in many cases the distinction is not clear. If there is no abatement element, it is unknown whether the condition has resolved or entered remission; applications and users should generally assume that the condition is still valid.  When abatementString exists, it implies the condition is abated.\r\n\r\nFor SDOH Conditions that have a fuzzy abatement period, a lower precision representation (e.g., month/year or year) may be used. However, for SDOH Conditions that end at a specific point in time (e.g., food insecurity may abate upon acquiring a new job or gaining eligibility to a food program) a higher precision representation (e.g., year/month/date) may also be used."
* recorder only Reference(Practitioner or PractitionerRole)
  * ^requirements = "For a condition that is autogenerated based on a QuestionnaireResponse, the AsserterDevice extension should be used to specify the device used to compute the condition and recorder should be empty."
* asserter only Reference(RelatedPerson or USCorePatientProfile or USCorePractitionerProfile or USCorePractitionerRoleProfile)
* asserter MS
  * ^short = "Person or device that asserts this condition"
  * ^definition = "The individual or device making the condition statement."
  * ^comment = "References SHALL be a reference to an actual FHIR resource, and SHALL be resolveable (allowing for access control, temporary unavailability, etc.). Resolution can be either by retrieval from the URL, or, where applicable by resource type, by treating an absolute reference as a canonical URL and looking it up in a local registry/repository.\r\n\r\nFor a condition that is autogenerated based on the patient directly answering a specific question from an SDOH screening questionnaire, the Condition.asserter should be the patient. For a condition that is autogenerated based on a computation that uses the patient’s answers to multiple questions, Condition.asserter should reference “Device” (using the using AsserterDevice extension) to specify the device used to compute the condition."
  * ^condition = "SDOH-Con-1"
* stage ..0
* evidence MS
  * code ^comment = "Not all terminology uses fit this general pattern. In some cases, models should not use CodeableConcept and use Coding directly and provide their own structure for managing text, codings, translations and the relationship between elements and pre- and post-coordination.\r\n\r\nInformation represented by Condition.evidence.code may overlap significantly with information represented by Condition.evidence.detail. Multiple approaches to representing the same information may negatively impact interoperability. Therefore, where similar infomation could be provided by either Condition.evidence.code or Condition.evidence.detail, it is recommended that Condition.evidence.detail should be used as supporting evidence for the condition.\r\n\r\nAs the Gravity Project continues to refine content for the SDOH categories (e.g., food, housing, transportation, etc.), this value set may be refined to codes that pertain to SDOH categories."
  * detail ^slicing.discriminator.type = #profile
    * ^slicing.discriminator.path = "resolve()"
    * ^slicing.rules = #open
    * ^comment = "References SHALL be a reference to an actual FHIR resource, and SHALL be resolveable (allowing for access control, temporary unavailability, etc.). Resolution can be either by retrieval from the URL, or, where applicable by resource type, by treating an absolute reference as a canonical URL and looking it up in a local registry/repository.\r\n\r\nAdditionally, see Comment for Condition.evidence.code."
  * detail contains SupportedDetail 0..* MS
  * detail[SupportedDetail] only Reference(SDOHCCObservationScreeningResponse or SDOHCCCondition or SDOHCCObservationAssessment)
    * ^definition = "Links to other relevant information."
    * ^requirements = "When a condition is based on one or more SDOH observations that were generated from questionnaire responses, Condition.evidence.detail should reference instances that comply with the SDOHCC Screening Response Observation. However, references to other instance types are also possible."